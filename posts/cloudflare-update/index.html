<!doctype html><html lang=en><head><title>Cloudflare Update and Various Fixes :: Ryan Porter's IT Resume</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="After unwisely heeding the prompts to migrate from Azure CDN to Azure Front Door, I exposed myself to massive costs. The fix (and a coincidental anniversary) caused a cascade of other bugs in my deployment pipeline."><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=/posts/cloudflare-update/><link rel=stylesheet href=/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css><link rel=stylesheet href=/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css><link rel=stylesheet href=/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css><link rel=stylesheet href=/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css><link rel=stylesheet href=/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css><link rel=stylesheet href=/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css><link rel=stylesheet href=/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css><link rel=stylesheet href=/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css><link rel=stylesheet href=/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css><link rel=stylesheet href=/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css><link rel=stylesheet href=/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css><link rel=stylesheet href=/css/terminal.min.7808c5ad053eddb6d0a72584d2b5eb48f6dfaebf88e34bd10f77c29e9caa7ff0.css><link rel=stylesheet href=/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=/favicon.png><link rel=apple-touch-icon href=/apple-touch-icon.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Cloudflare Update and Various Fixes"><meta property="og:description" content="After unwisely heeding the prompts to migrate from Azure CDN to Azure Front Door, I exposed myself to massive costs. The fix (and a coincidental anniversary) caused a cascade of other bugs in my deployment pipeline."><meta property="og:url" content="/posts/cloudflare-update/"><meta property="og:site_name" content="Ryan Porter's IT Resume"><meta property="og:image" content="/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-12-13 00:00:00 +0000 UTC"></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo></div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about/>About</a></li><li><a href=/resume>Resume</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about/>About</a></li><li><a href=/resume>Resume</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=/posts/cloudflare-update/>Cloudflare Update and Various Fixes</a></h1><div class=post-meta><time class=post-date>2024-12-13[Updated::2024-12-13]</time><span class=post-author>Ryan Porter</span><span class=post-reading-time>2 min read (372 words)</span></div><span class=post-tags>#<a href=/tags/cloudflare/>Cloudflare</a>&nbsp;
#<a href=/tags/dns/>DNS</a>&nbsp;
#<a href=/tags/azure/>Azure</a>&nbsp;
#<a href=/tags/terraform/>Terraform</a>&nbsp;
#<a href=/tags/cypress/>Cypress</a>&nbsp;
#<a href=/tags/ci/cd/>CI/CD</a>&nbsp;</span><div class=post-content><div><p>After unwisely heeding the prompts to migrate from Azure CDN to Azure Front Door, I exposed myself to massive costs. The fix (and a coincidental anniversary) caused a cascade of other bugs in my deployment pipeline. Here&rsquo;s what happened and how I fixed it.</p><p>Previously, <a href=https://www.techno-literate.com/posts/switching-to-cloudflare-dns/>I switched from Wordpress.com to Cloudflare</a> as my domain registrar and DNS provider. Not long after, I read one of the pop-up messages in the Azure Portal encouraging me to migrate from Azure CDN, which is sunsetting in 2027, to Azure Front Door, which is the latest and greatest content delivery service in Azure. Foolishly, I went ahead with the migration without researching the associated costs. Fellow Cloud Resume Challengers should take heed: Front Door has a monthly base cost of $30, or $360 per year! As soon as I realized that, I deleted Front Door and instead shifted entirely to Cloudflare, which offers content delivery by default with its free tier.</p><p><strong>Issues to be aware of</strong>
When you stop using an Azure CDN solution (either Azure CDN or Azure Front Door), Azure&rsquo;s TLS certificates will no longer be associated with your domain, but will instead only cover the default domain for your storage account (*.web.core.windows.net). Visitors to your website will get an error and won&rsquo;t be able to view your site at all. This is solved by enabling proxying on Cloudflare for your domain:</p><p><img src=img/cloudflare-proxy.png alt="Cloudflare proxy settings"></p><p>If you choose to change your custom domain name in your Storage Account settings, you may have trouble verifying it while the proxying is enabled. You can turn off proxying long enough for the validation to complete, then turn it back on in the Cloudflare dashboard (same place as the above image, in the DNS Records section).</p><p>Did I mention an unfortunate anniversary? Right as I began to address the Front Door issue and update my Terraform code, my access keys in Azure expired. It was a bit of a nightmare to identify which ones I specifically needed to refresh, so I suggest that if you encounter a similar issue, that you label the secret keys in an obvious way.</p><p>Everything is working now, and I can&rsquo;t express how good it feels to tackle this challenge and finally get a positive result!</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/switching-to-cloudflare-dns/><span class=button__text>Switching to Cloudflare DNS</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Copyright 2023 Ryan Porter</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>