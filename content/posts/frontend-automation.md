+++
title = "Frontend Automation"
date = "2023-11-21T07:50:16-08:00"
author = "Ryan Porter"
authorTwitter = "" #do not include @
cover = ""
tags = ["azure", "GitHub", "ci/cd"]
keywords = ["", ""]
description = ""
showFullContent = false
readingTime = true
hideComments = false
color = "" #color from the theme settings
draft = true
+++
# Frontend Automation

I've completed the DevOps mod for Chunk 1 of the Cloud Resume Challenge. I've learned so much, especially that there are still things I don't know. I'm excited to continue this project and learn a lot more!

Here is what I accomplished in this chunk:

1. I created a static website using the [Hugo static site generator](https://gohugo.io).
2. I hosted the site using [Azure Storage](https://learn.microsoft.com/en-us/azure/storage/common/storage-introduction) and [Azure CDN](https://learn.microsoft.com/en-us/azure/frontdoor/).
3. I created a basic workflow using [GitHub Actions](https://github.com/features/actions), including:
   - Building the Hugo static site each time I push a change to my repository,
   - Deploy Azure infrastructure using Terraform,
   - Uploading new website files to Azure Storage, and
   - Clearing the Azure CDN cache.
4. I built a simple test battery using Cypress and appended it to the GitHub Actions workflow.

## Challenges
### Uploading Files
The first major challenge that I had to overcome was automating the uploading of my website files. I _struggled_ to get this working, constantly getting this error:
```bash
ERROR: incorrect usage: source must be an existing directory
```
The solution was that I had to get my permissions straight for GitHub Actions and in Azure. On the Azure side, the security principle I created for automation needed to have Contributor permissions, and on GitHub, workflow permissions needed to be read and write, "Allow GitHub to create and approve pull requests" had to be checked, and my fine-grained personal access token needed to also be given read and write access to code.

### Cypress Testing
Configuring Cypress testing was much more difficult to figure out. I though I had it set up in GitHub Actions correctly, but every time I ran the workflow I would get one of various errors, including the following:
```bash
Cannot find module 'cypress'
Require stack:
- /home/runner/work/_actions/cypress-io/github-action/v6/dist/index.js
```
```bash
Action failed. Missing package manager lockfile. Expecting one of package-lock.json (npm), pnpm-lock.yaml (pnpm) or yarn.lock (yarn) in working-directory /home/runner/work/techno-literate-blog/techno-literate-blog
```
I'm sure some of you reading this can already see the problem, but it wasn't obvious to me and I didn't find any documentation that directly stated what the cause was. In short, _I hadn't actually installed Cypress!_ The first step was to install Node.js locally, and run `npm init` in my local git repository. Then, I was able to use `npm install cypress --save-dev` to properly install Cypress.

Cypress appears to be quite powerful and capable, and I'm not sure I've entirely wrapped my brain around it yet. I wanted my Cypress tests to just loop through my website and run on every single page, but I don't think that is how the software is intended to be used. I finally ended up making a couple very specific tests to run every time I update the site: First, make sure every page in the sitemap generated by Hugo is accessible, and second, make sure CSS is rendering properly on the home page (a problem I had with Hugo early on).

## Final Thoughts and Code
I'm very proud of myself for getting through this chunk, and especially for tackling the optional DevOps mod. As I stated before, I can tell that there are still many things for me to learn, but I feel much more confident in my ability to do so after successfully getting this site online!

**Here is the most important code from this chunk.**

```json

```